{
  "configurations": [
    {
        "cluster-env": {
            "properties": {
                "command_retry_max_time_in_sec": "1200"
            }
        }
    },
    {% if 'ranger' in security  %}
    {
        "admin-properties": {
            "properties": {
                "db_root_password": "rangerdba",
                "db_password": "rangerdba",
                "policymgr_external_url": "http:\/\/localhost:6080",
                "db_root_user": "rangerdba",
                "DB_FLAVOR": "MYSQL",
                "db_user": "rangerdba",
                "db_name": "ranger",
                "db_host": "localhost",
                "SQL_CONNECTOR_JAR": "\/usr\/share\/java\/mysql-connector-java.jar"
            }
        }
    },
    {
        "ranger-env": {
            "properties": {
                "is_solrCloud_enabled": "true",
                "ranger_privelege_user_jdbc_url": "jdbc:mysql:\/\/localhost",
                "ranger_admin_password": "Rangerpassword@123",
                "is_external_solrCloud_enabled": "false",
                "is_external_solrCloud_kerberos": "false",
                "ranger-kafka-plugin-enabled": "No",
                "ranger-nifi-plugin-enabled": "Yes",
                "xasecure.audit.destination.hdfs": "false"
            }
        }
    },
    {
        "ranger-admin-site": {
            "properties": {
                "ranger.jpa.jdbc.driver": "com.mysql.jdbc.Driver",
                "ranger.jpa.jdbc.url": "jdbc:mysql:\/\/localhost\/ranger",
                "ranger.audit.source.type": "solr"
            }
        }
    },
    {% endif %}
    {% if security in ('kerberos', 'ranger') %}
    {
      "kerberos-env": {
          "properties" : {
              "realm" : "HDF.COM",
              "kdc_type" : "mit-kdc",
              "kdc_hosts" : "ctr-e134-1499953498516-82150-01-000002.hwx.site",
              "admin_server_host" : "ctr-e134-1499953498516-82150-01-000002.hwx.site"
          }
      }
    },
    {
      "krb5-conf": {
          "properties" : {
              "manage_krb5_conf" : "true",
              "domains" : "HDF.COM",
              "content" : "[libdefaults]\nrenew_lifetime = 7d\nforwardable = true\ndefault_realm = HDF.COM\nticket_lifetime = 24h\ndns_lookup_realm = false\ndns_lookup_kdc = false\ndefault_ccache_name = /tmp/krb5cc_%{uid}\n#default_tgs_enctypes = aes des3-cbc-sha1 rc4 des-cbc-md5\n#default_tkt_enctypes = aes des3-cbc-sha1 rc4 des-cbc-md5\n[logging]\ndefault = FILE:/var/log/krb5kdc.log\nadmin_server = FILE:/var/log/kadmind.log\nkdc = FILE:/var/log/krb5kdc.log\n[realms]\nHDF.COM = {\nadmin_server = ctr-e134-1499953498516-82150-01-000002.hwx.site\nkdc = ctr-e134-1499953498516-82150-01-000002.hwx.site\n}\n"
          }
      }
    },
    {% endif %}
    {
      "streamline-common": {
        "properties": {
          "database_name": "streamline",
          "streamline.storage.connector.user": "streamline",
          "streamline.storage.type": "mysql",
          "registry.url": "http://%HOSTGROUP::master_2%:7788/api/v1",
          "streamline.dashboard.url": "http://%HOSTGROUP::master_2%:9090",
          "streamline.storage.connector.password": "streamline",
          "streamline.storage.connector.connectURI": "jdbc:mysql://localhost:3306/streamline",
          "jar.storage.type": "local"
        }
      }
    },
    {
      "nifi-ambari-config": {
        "properties": {
          "nifi.max_mem": "4G",
          "nifi.initial_mem": "4G",
          "nifi.sensitive.props.key": "Hortonworks@123",
          "nifi.security.encrypt.configuration.password": "Hortonworks@123"
        }
      }
    },
    {
      "nifi-ambari-ssl-config": {
        "properties": {
          {% if security in ('kerberos', 'ranger') %}
          "nifi.node.ssl.isenabled": "true",
          "nifi.security.keystoreType": "JKS",
          "nifi.security.truststoreType": "JKS",
          "nifi.security.keystorePasswd": "Hortonworks@123",
          "nifi.security.keyPasswd": "Hortonworks@123",
          "nifi.security.truststorePasswd": "Hortonworks@123",
          {% else %}
          "nifi.node.ssl.isenabled": "false",
          {% endif %}
          "nifi.toolkit.tls.token": "Hortonworks@123",
          "nifi.initial.admin.identity": "hrt_qa@HDF.COM"
        }
      }
    },
    {
      "registry-common": {
        "properties": {
          "database_name": "registry",
          "registry.storage.connector.user": "registry",
          "registry.storage.type": "mysql",
          "registry.storage.connector.password": "registry",
          "registry.storage.connector.connectURI": "jdbc:mysql://localhost:3306/registry",
          "jar.storage.type": "local"
        }
      }
    },
    {% if security in ('kerberos', 'ranger') %}
    {
      "kafka-broker": {
        "properties": {
          "auto.create.topics.enable": "true",
          "delete.topic.enable": "true",
          "listeners": "SASL_PLAINTEXT://localhost:6668,PLAINTEXT://localhost:6669",
          "security.inter.broker.protocol": "SASL_PLAINTEXT"
        }
      }
    },
    {% endif %}
    {
      "nifi-properties": {
        "properties": {
          {% if security in ('kerberos', 'ranger') %}
          "nifi.security.user.login.identity.provider": "kerberos-provider",
          "nifi.security.identity.mapping.pattern.dn": "^CN=(.*?), OU=(.*?)$",
          "nifi.security.identity.mapping.pattern.kerb": "^(.*?)/instance@(.*?)$",
          "nifi.security.identity.mapping.value.dn": "$1@$2",
          "nifi.security.identity.mapping.value.kerb": "$1@$2",
          {% endif %}
          "nifi.web.https.network.interface.default": "eth0",
          "nifi.cluster.node.protocol.threads": "20",
          "nifi.cluster.node.connection.timeout": "30 secs",
          "nifi.cluster.node.read.timeout": "30 secs",
          "nifi.cluster.flow.election.max.wait.time" : "2 mins",
          "nifi.remote.input.socket.port" : "9889"
        }
      }
    },
    {
      "nifi-registry-properties": {
           "properties": {
                {% if security in ('kerberos', 'ranger') %}
                "nifi.registry.security.identity.mapping.pattern.dn": "^CN=(.*?), OU=(.*?)$",
                "nifi.registry.security.identity.mapping.value.dn": "$1@$2",
                "nifi.registry.security.identity.mapping.pattern.kerb": "^(.*?)\/instance@(.*?)$",
                "nifi.registry.security.identity.mapping.value.kerb": "$1@$2"
                {% endif %}
           }
       }
    },
    {
      "nifi-registry-ambari-ssl-config": {
          "properties": {
                {% if security in ('kerberos', 'ranger') %}
                "nifi.registry.ssl.isenabled": "true",
                "nifi.registry.initial.admin.identity": "hrt_qa@HDF.COM",
                "nifi.registry.security.keyPasswd": "qwertyuiop[]1234",
                "nifi.registry.security.keystorePasswd": "qwertyuiop[]1234",
                "nifi.registry.security.truststorePasswd": "qwertyuiop[]1234",
                "nifi.registry.security.truststoreType": "JKS"
                {% else %}
                "nifi.registry.ssl.isenabled": "false"
                {% endif %}
          }
       }
    },
    {
       "nifi-registry-ambari-config": {
            "properties": {
                "nifi.registry.security.encrypt.configuration.password": "Hortonworks@123"
            }
        }
    }

  ],
  "host_groups": [
    {
      "components": [
        {
          "name": "ZOOKEEPER_SERVER"
        },
        {
          "name": "AMBARI_SERVER"
        },
        {
          "name": "METRICS_MONITOR"
        },
        {
          "name": "SUPERVISOR"
        },
        {
          "name": "INFRA_SOLR"
        },
        {
          "name": "INFRA_SOLR_CLIENT"
        },
        {
          "name": "LOGSEARCH_LOGFEEDER"
        },
        {
          "name": "LOGSEARCH_SERVER"
        },
        {
          "name": "METRICS_COLLECTOR"
        },
        {
          "name": "METRICS_GRAFANA"
        },
        {
          "name": "NIFI_CA"
        },
        {
          "name": "NIMBUS"
        },
        {
          "name": "DRPC_SERVER"
        },
        {
          "name": "STORM_UI_SERVER"
        },
        {
          "name": "ZOOKEEPER_CLIENT"
        }
      ],
      "configurations": [],
      "name": "master_1",
      "cardinality": "1"
    },
    {
      "components": [
        {
          "name": "REGISTRY_SERVER"
        },
        {
          "name": "ZOOKEEPER_SERVER"
        },
        {
          "name": "STREAMLINE_SERVER"
        },
        {
          "name": "METRICS_MONITOR"
        },
        {
          "name": "SUPERVISOR"
        },
        {
          "name": "LOGSEARCH_LOGFEEDER"
        },
        {
          "name": "INFRA_SOLR"
        },
        {
          "name": "INFRA_SOLR_CLIENT"
        },
        {% if 'ranger' in security  %}
        {
            "name": "RANGER_ADMIN"
        },
        {
            "name": "RANGER_USERSYNC"
        },
        {
            "name": "RANGER_TAGSYNC"
        },
        {% endif %}
        {
            "name": "NIMBUS"
        },
        {
            "name": "ZOOKEEPER_CLIENT"
        }
      ],
      "configurations": [],
      "name": "master_2",
      "cardinality": "1"
    },
    {
      "components": [
        {
          "name": "ZOOKEEPER_SERVER"
        },
        {
          "name": "METRICS_MONITOR"
        },
        {
          "name": "SUPERVISOR"
        },
        {
          "name": "NIFI_MASTER"
        },
        {
          "name": "LOGSEARCH_LOGFEEDER"
        },
        {
          "name": "INFRA_SOLR"
        },
        {
          "name": "INFRA_SOLR_CLIENT"
        },
        {
          "name": "KAFKA_BROKER"
        },
        {
          "name": "ZOOKEEPER_CLIENT"
        }
      ],
      "configurations": [],
      "name": "master_3",
      "cardinality": "1"
    },
    {
      "components": [
        {
          "name": "METRICS_MONITOR"
        },
        {
          "name": "NIFI_MASTER"
        },
        {
          "name": "LOGSEARCH_LOGFEEDER"
        },
        {
          "name": "ZOOKEEPER_CLIENT"
        },
        {
          "name": "SUPERVISOR"
        },
        {
          "name": "KAFKA_BROKER"
        }
      ],
      "configurations": [],
      "name": "master_4",
      "cardinality": "1"
    },
    {
      "components": [
        {
          "name": "METRICS_MONITOR"
        },
        {
          "name": "KAFKA_BROKER"
        },
        {
          "name": "NIFI_MASTER"
        },
        {
          "name": "LOGSEARCH_LOGFEEDER"
        },
        {
          "name": "ZOOKEEPER_CLIENT"
        },
        {
          "name": "SUPERVISOR"
        }
      ],
      "configurations": [],
      "name": "master_5",
      "cardinality": "1"
    }
  ],
  "Blueprints": {
    "blueprint_name": "{{ cluster_name }}",
    "stack_name": "{{ stack }}",
    "stack_version": "{{ stack_major_version }}"
  }
}
