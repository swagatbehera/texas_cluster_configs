#!/bin/sh

set -eux

# Packages for network slowness debug purpose
yum install -y iftop iperf tcpdump

# Set http_proxy as workaround for the install failures
http_proxy_var=http://hwx-eng:5XD6xKQDiKDjOD@cache.eng.hortonworks.com:1280
proxy_host=http://cache.eng.hortonworks.com:1280
no_proxy_list='0.0.0.0,localhost,127.0.0.1,.openstacklocal,.novalocal,169.254.169.254,openstack.eng.hortonworks.com,dashboard.qe.hortonworks.com,172.22.192.250,192.175.27.100,ad-ec2.qe.hortonworks.com,ad-nano.qe.hortonworks.com,.site,.hwx.site,.hwx.site.com,172.27.0.101'

printf "\nexport http_proxy='${http_proxy_var}'\nexport https_proxy='${http_proxy_var}'" >> /etc/profile.d/hw-caching-proxy.sh
printf "\nexport no_proxy=${no_proxy_list}" >> /etc/profile.d/hw-caching-proxy.sh
printf "\nproxy=${proxy_host}\nproxy_username=${proxy_host}\nproxy_password=5XD6xKQDiKDjOD" >> /etc/yum.conf
